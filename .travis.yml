sudo: required
dist: bionic
language: python
python:
  - "3.7"

# command to install dependencies
install:
  - sudo add-apt-repository ppa:deadsnakes/ppa --yes
  - sudo apt-get --yes --force-yes install python3-venv
  - pip install ansible
  - pip install flake8
  - pip install wheel       # for ansible-test
  - pip install Jinja2      # for ansible-test
  - pip3 install pyyaml     # for ansible-test
  - pip3 install voluptuous # for ansible-test
  - pip install pyyaml      # for compile test with Python2
  - ansible --version

env:
  global:
	 secure: LN1GNTkhBKFqgfPJod9xRr8mPvJH2pls04PXY7L/9bI46FMDldWLUYSxdh5sxqqAflWIi6Tby6qcyYxI0Ppfzy6xB5Qz0GPovgkRN07gy3bxhwcjyJBAqkTF4+hSLnLZDCFsP7RDc4wwUsbTN1TEsrEsPkj+IWzlZCKbMZGmcQn2NWOT9MFoXDCH7Wr8LKWqFkUosIM7nSX0e9v5g5LMyXe2i8LidkFSZkESKVEchD12iad/1xTNnBsYZVzGVHNOPXlkpTjhSEalnd4tkTc8LwlUEl/XppJxUE1rHhlKv7GaVyMDoSw2BAT7RmWVWmI0Fl8/I39/KcZQUQeFwJX+J5/my1Y+6gu1RKpq4+re3sQ5bBpw8QFWe300XMNGRXqGNSBg3RYrlxsRcYFBAwr3DADzk/uTJHed+o76YFO3NeAPa7FMEn4H/XQu9a6hNO4WisFHQAUf01beIltIcucsM4e376gF5zNQzGBaaWfZr6O6ANmt1mdKN0uEdHjggarb7RQnTIq3wK+vuecEJabc8ytYQ/R2goBAhinYXehDF8ka3w0SWbrU10k3P2+ZHvbvGP1FSdEFHx/iMggx5r7vdIgK1kIg/fmWWYGHz1sIMq36uYhsloKfd9uMuznFoIQfgLBQH4gKEAkvO8/D6qM1NsTRc2spSWWQLHAJeWirhNo=

# command to run tests
script:

  # With flake ignore
  #  E402: <module> level import not at top of file (as per Ansible module developement)
  #  W503: line break before binary operator (PEP8 advices to put logical operator ahead)
  - flake8 library/* --max-line-length=160 --ignore=E402,W503

  # checking yaml syntax is not relevant since there are just examples.
  #- ansible-playbook playbook_aix_flrtvc.yml --syntax-check
  #- ansible-playbook playbook_aix_suma_targets_all.yml --syntax-check

  - bash devops/bin/gen_doc.sh
  - bash devops/bin/sanity_test.sh

# push the generated documentation using GitHub Pages
deploy:
    provider: pages
    skip_cleanup: true
    github_token: $GITHUB_API_KEY
    local_dir: documentation
    keep_history: true
    on:
        branch: master
